# bus_berth_allocation

This repository contains the simulation model and the berth allocation algorithms used in a paper titled "Efficient Heuristic Methods for Berth Allocation at Multi-line, Multi-berth Curbside Bus Stops", which is currently being under review by "Transportation Research Part C".

## Installation

The required packages are listed in `requirements.txt`. Please use the package manager pip to install:

``
pip install -r requirements.txt
``

Moreover, please install `mongodb` following: <https://www.mongodb.com/docs/manual/installation/>.

## Usage
The repository uses `mongodb` to store the numerical experiments results, and use the `sacred` package to manage the experiment results. The basic usage flow is as follows:

1. In `line_profile.py`, the bus line datasets used in the paper can be generated by calling the function `manual_add_to_db`. The datasets will then be added into `mongodb` database. By default, the line dataset will be stored in `line_profile` collection of `inputs` database.
2. For isolated-bus-stop cases, the `isolated_main_enumerate.py` will enumerate all the possible berth allocations and run the simulation to obtain the steady-state queueing delay metric. You can specify different queueing rules, line set no and so on. (Note that multiple threads can be used for parallel computing so as to speed up.) All the results will be saved in the `mongodb`, managed by `sacred`. By default, the simulation results will be stored in `runs` collection of `cx` database, where `x` is the berth number.
3. Given all the enumerated berth allocations simulated in step 2, you can run the `algo_main_for_enum.py` script, wherein you can specify the algorithm type (CNP method or Tan's method) and corresponding parameters. The algorithm will automatically retrieve the simulation results stored in the database. If no simulated berth allocation plan is found in the database, the simulation will be conducted immediately to evaluate the allocation plan. The algorithm results will be stored in `runs` collection of `cx_res` database, where `x` is the berth number.
4. For near- and far-side stops, you can run `signal_main_enumerate.py` script. In addition to the isolated scenario, you can also specify the cycle length, buffer size and green ratio for near- and far-side stops.

## Feel free to ask me if you have any questions! :blush:

My email address is: <shenminyu@swufe.edu.cn>

## Additional results on other bus line sets
**The following  provides experimental results of the proposed CNP algorithm for more line sets. Note that for line set 2, the mean dwell times and bus arrival rate (inverse of bus headway) are negatively correlated.**

### Line set information
| Set | Line No. | $\lambda_l$ (buses/hr) | $\mu_l$ (seconds) | Set | Line No. | $\lambda_l$ (buses/hr) | $\mu_l$ (seconds) |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 2 | 1 | 20.01 | 12.87 | 3 | 1 | 17.79 | 9.10 | 
| 2 | 2 | 18.48 | 18.50 | 3 | 2 | 14.77 | 24.89 | 
| 2 | 3 | 16.76 | 19.62 | 3 | 3 | 7.69 | 25.42 | 
| 2 | 4 | 15.34 | 21.11 | 3 | 4 | 10.43 | 32.49 | 
| 2 | 5 | 10.83 | 24.42 | 3 | 5 | 16.14 | 42.57 | 
| 2 | 6 | 9.60 | 25.14 |  3 | 6 | 6.60 | 17.37 | 
| 2 | 7 | 8.62 | 25.53 |  3 | 7 | 19.27 | 15.91 | 
| 2 | 8 | 7.99 | 25.68 |  3 | 8 | 6.84 | 30.34 | 
| 2 | 9 | 7.96 | 28.94 |  3 | 9 | 9.24 | 25.64 | 
| 2 | 10 | 7.11 | 30.40 |  3 | 10 | 8.30 | 19.33 | 
| 2 | 11 | 6.86 | 30.79 |  3 | 11 | 5.25 | 33.08 | 
| 2 | 12 | 5.45 | 37.01 |  3 | 12 | 7.67 | 23.86 | 

### Results

The figures are similar to the ones shown in the paper. The description is thus omitted here. Readers can refer to the paper for more details. 

| NO rule, mid-block stop | LO rule, mid-block stop|
| ----------------------------------- | ----------------------------------- |
| ![cat](figs/c%3D2_FIFO_iso.jpg) | ![dog](figs/c%3D2_LO-Out_iso.jpg) |

| FO rule, mid-block stop | NO rule, near-side stop|
| ----------------------------------- | ----------------------------------- |
| ![cat](figs/c%3D2_FO-Free_iso.jpg) | ![dog](figs/c%3D2_FIFO_near.jpg) |

| LO rule, near-side stop | FO rule, near-side stop|
| ----------------------------------- | ----------------------------------- |
| ![cat](figs/c%3D2_LO-Out_near.jpg) | ![dog](figs/c%3D2_FO-Free_near.jpg) |
